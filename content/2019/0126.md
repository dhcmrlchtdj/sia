+++
date = '2019-01-25'
title = '前端项目'
tags = ['fe']
+++

## 可维护性

### 多页

路由可以说是前端框架的标配了。使用前端框架写的项目，大都会以 SPA 的方式呈现给用户。
我个人一直不太喜欢这种情况。大部分网站都是内容为主的，完全没必要实现成 SPA。
实现成 SPA 反倒会使得项目可维护下降。依赖不敢升级、配置不敢修改、代码不敢删除，这种情况见得太多了。

这应该不是我一个人遇到的问题。
阿里有前端建议不要用 lock 锁定依赖版本。因为锁定之后，项目维护者很少主动升级版本。
为什么不敢升级？稳定性没有保证。
可以单独页面做升级吗？做不到，配置都在一起的。

如果是多页应用，这种情况应该会得到缓解。
每个页面都可以独立开发部署，可以独立升级依赖，改到服务不可用也只影响单个页面。
不会很棒吗？

### 自动化测试

也许有人会问，自动化测试不能解决这些问题吗？
想了想，好像确实可以靠自动化测试解决。
可惜我接触过的项目，自动化测试的覆盖率都不高。

前端的自动化测试，一方面是底层组件的单元测试，一方面全流程的集成测试。
单元测试还能强制要求，集成测试遇到的困难就大了很多。
全流程的集成测试，我希望至少有 UI 的自动对比和操作的录制回放。
但在短期内，两方面都无法落地。
没有这种自动化流程，靠开发手写测试，成本太高，效率太低。

即使有了自动化测试，前面提到的维护成本也并没有降低，仍是牵一发动全身，收益在于结果的稳定性。
多页和测试并不矛盾，我更多是希望多页独立之后，整体的维护成本能降低。

### 构建

构建也是现在前端项目不可或缺的一部分了。
一个多页场景里，以 html 为入口去完成整个构建，应该会更清晰。
我个人很喜欢纯静态的页面，路由与本地目录直接映射，简单直观。

---

## 可组合性

## 复用

业务场景变得复杂之后，开发效率问题会经常被提及。
然后就是老生常谈的代码复用、功能复用。

从公共函数到外部依赖，代码复用已经差不多了。

功能的复用怎么办呢？
只影响局部页面，并且功能内聚，比如登入、评论等。
我对外部脚本的方式挺满意的，auth0、utterances 都挺好。
（不过脚本的复用，必然引出升级的问题。

不过复杂业务中，更常见的一个场景，是页面的复用。
以前见过各种 iframe 嵌套，不知道现在用得还多不多。
iframe 的隔离性很好，但内外互动太糟糕的。
现在前端微服务的概念也有人在提，还没深入去看，不知道真实场景下好用不。

如果多页真得足够灵活，直接复制整个页面或许也是个办法。
或者换一种形式，有点类似模块的引入。不过，引入的不是模块，而是整个页面。引入的点也不是页面内，而是网关、代理这一层。
平台的维护者，不再是前端开发，而是网关层的配置者。由配置者选择页面，组合成服务。


### 更新

靠引入的方式实现复用，必然会遇到更新的问题。
开发者角度，希望外部依赖稳定，不要随意变化。
服务提供方角度，希望外部能快速更新到最新版，减少负担。
这个矛盾几乎是不可调和的。

实践中，我还是倾向保持稳定。
为了保证更新，开发者也需要向服务方进行注册，方便服务方反向的通知。
如果更新的成本足够低，那么推动开发者进行更新也就足够了。
（当然，业务开发中还有一种方式，上级压力足够大 🙈

---

## 状态管理

如果这是我第一次在这说“不喜欢 redux/vuex”，我能肯定这绝不会是最后一次。

组件有 props 和 state 是没问题的。
就像页面有 query/cookie 和 localStorage。
对应到函数就是参数和堆栈。
这种设计本身是没问题的，但只适合底层组件。
业务组件涉及大量的状态传递，完全按这种方式实现，实在太复杂了。
这个状态传递，和 [函数式编程如何优雅的处理很多 多个函数都要用到的 参数](https://www.zhihu.com/question/58557828) 应该是个等价的问题。

redux/vuex 这些框架，让人用着就感觉难受。
除了样板代码之外，我觉得是底层设计存在某些问题，才会让人这么不舒服。

那么，如果把要求放低一些，直接用全部变量行不行。
如果是多页，我们不需要考虑页面间的数据隔离，但如何实现组件间的数据隔离呢？
这应该不是一个无法解决的问题，粗暴一点甚至可以考虑用组件在 DOM 上的位置作为标识。
我的想法，整体和前面的页面中间层有点类似，也是实现一个统一的管控层。
具体还需要再好好想想……
先到这吧……

---

## 总结

- 项目维护 - 多页应用
- 页面组合 - 页面引入
- 状态管理 - 全局变量
