+++
date = '2012-11-16'
title = '鼠标哪里来'
tags = ['js']
+++

前段时间看到[JS判断鼠标从什么方向进入一个容器][rubylouvre]，手痒写了一个，
简单描述下想法和几个遇到问题的地方。
[rubylouvre]: http://www.cnblogs.com/rubylouvre/archive/2012/11/06/2757175.html

要获取进入的方向，我最开始的想法是角度。
获取容器左上角的坐标（也就是原点O），
再获取鼠标进入容器时的坐标（简写为 x，y），
然后计算出与上边界的夹角，结果差不多就出来了。

其实要获取坐标，最简单的方法是使用`event.offsetX/Y`，可是各个浏览器返回值不同，
所以才要去获取原点 O 的坐标，间接计算出 x y。
我用`event.clientX/Y`获取鼠标进入时的坐标，
用`elem.getBoundingClientRect()`获取容器的坐标还有大小，
这两个的结果都是相对于浏览器窗口的。
由于浏览器的不同，获取坐标其实是挺麻烦的事情，自己写函数难以面面俱到，
实际应用还是用 jQuery 等类库获取坐标更简单些。

之后可以判断，当`y===0`时，鼠标是从上面进入……然后就出错了。
想法其实没错，但是浏览器的反映跟不上鼠标，当鼠标快速从上方进入容器时，
y 的值是不为 0 的。所以不得不换个思路。

之后的想法是取容器的中点为原点 O，然后计算鼠标进入点与 x 轴的夹角。
有了之前的坐标，计算这个夹角是件很简单的事情。
先求出 x y，然后计算`Math.atan2(y, x)`，这个就是夹角的弧度，
不好懂的话可以乘上`180 / Math.PI`，得到角度。
之后只要划分出每个边对应的角度/弧度区间，问题就解决了。

两种方法。
其一，这也是我自己最早的想法，先用容器的宽高计算出临界值，再进行比较。
其二，这个是看别人代码的做法，在计算`Math.atan2(y, x)`之前，对 x y 进行标准化，
再和 45/135 度比较。
我最初考虑用方法一，因为可以把容器的各个属性都缓存起来，
避免鼠标进入容器时重复计算的开销。
但是后来发现，一旦页面滚动，容器相对窗口的坐标就发生改变，
再考虑到如果动态修改了容器的大小，那么相对页面的坐标也会发生改变，
所以就没有使用缓存，而是在每次进入时计算坐标。
如果能保证不改变容器的大小，然后缓存相对 html 文档的坐标，应该也是可行的。

到这里，结果就出来了。
stackoverflow 里提供的那段代码，没仔细看，乘了好几次，没看懂，就不多说了。
想看代码的话，我自己写的放在了
[github](https://github.com/dhcmrlchtdj/toolkit/blob/master/snippet/javascript/mouse_direction.js)。

------

这篇文章其实没什么干货……太久没写东西了，所以随手写一点……

之前考虑用什么方法获取坐标，又一个个试过去，确实麻烦了点。
以后乖乖用类库算了。

另外，准备找时间实现下 rss 订阅，还想把界面换一换，还有……都是麻烦事。
